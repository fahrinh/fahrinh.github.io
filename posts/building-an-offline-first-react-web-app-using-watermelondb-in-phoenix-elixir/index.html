<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title class=pjax-title>Building an Offline-First React Web App Using WatermelonDB in Phoenix (Elixir) - Fahri NH</title><meta name=Description content><meta property="og:title" content="Building an Offline-First React Web App Using WatermelonDB in Phoenix (Elixir)"><meta property="og:description" content="We will build a web application that supports local db synced with remote db. This post is a continuation from the previous post: How to Build WatermelonDB Sync Backend in Elixir."><meta property="og:type" content="article"><meta property="og:url" content="https://fahri.id/posts/building-an-offline-first-react-web-app-using-watermelondb-in-phoenix-elixir/"><meta property="og:image" content="https://fahri.id/images/blog-app-mockup.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-04-29T10:58:39+07:00"><meta property="article:modified_time" content="2020-04-29T10:58:39+07:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://fahri.id/images/blog-app-mockup.png"><meta name=twitter:title content="Building an Offline-First React Web App Using WatermelonDB in Phoenix (Elixir)"><meta name=twitter:description content="We will build a web application that supports local db synced with remote db. This post is a continuation from the previous post: How to Build WatermelonDB Sync Backend in Elixir."><meta name=application-name content="Fahri NH"><meta name=apple-mobile-web-app-title content="Fahri NH"><meta name=theme-color content="#f8f8f8"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=canonical href=https://fahri.id/posts/building-an-offline-first-react-web-app-using-watermelondb-in-phoenix-elixir/><link rel=prev href=https://fahri.id/posts/how-to-build-watermelondb-sync-backend-in-elixir/><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href=/lib/fontawesome-free/all.min.css><noscript><link rel=stylesheet href=/lib/fontawesome-free/all.min.css></noscript><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href=/lib/animate/animate.min.css><noscript><link rel=stylesheet href=/lib/animate/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Building an Offline-First React Web App Using WatermelonDB in Phoenix (Elixir)","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/fahri.id\/posts\/building-an-offline-first-react-web-app-using-watermelondb-in-phoenix-elixir\/"},"genre":"posts","keywords":"WatermelonDB, Offline First App","wordcount":1033,"url":"https:\/\/fahri.id\/posts\/building-an-offline-first-react-web-app-using-watermelondb-in-phoenix-elixir\/","datePublished":"2020-04-29T10:58:39+07:00","dateModified":"2020-04-29T10:58:39+07:00","publisher":{"@type":"Organization","name":"Fahri"},"author":{"@type":"Person","name":"Fahri"},"description":""}</script></head><body header-desktop header-mobile><script type=text/javascript>function setTheme(e){document.body.setAttribute("theme",e),document.documentElement.style.setProperty("color-scheme",e==="light"?"light":"dark")}function saveTheme(e){window.localStorage&&localStorage.setItem("theme",e)}function getMeta(e){const t=document.getElementsByTagName("meta");for(let n=0;n<t.length;n++)if(t[n].getAttribute("name")===e)return t[n];return""}if(window.localStorage&&localStorage.getItem("theme")){let e=localStorage.getItem("theme");e==="light"||e==="dark"||e==="black"?setTheme(e):setTheme(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")}else""==="light"||""==="dark"||""==="black"?(setTheme(""),saveTheme("")):(saveTheme("auto"),setTheme(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"));let metaColors={light:"#f8f8f8",dark:"#252627",black:"#000000"};getMeta("theme-color").content=metaColors[document.body.getAttribute("theme")]</script><div id=back-to-top></div><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Fahri NH">Fahri NH</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>Posts </a><a class=menu-item href=/tags/>Tags </a><a class=menu-item href=/categories/>Categories </a><a class=menu-item href=/about/ title=About>About </a><span class="menu-item delimiter"></span><a href=# onclick=return!1 class="menu-item language" title="Select Language">English<i class="fas fa-chevron-right fa-fw"></i>
<select class=language-select title="Select Language" id=language-select-desktop onchange="location=this.value"><option value=/posts/building-an-offline-first-react-web-app-using-watermelondb-in-phoenix-elixir/ selected>English</option></select>
</a><a href=# onclick=return!1 class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Fahri NH">Fahri NH</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/posts/ title>Posts</a><a class=menu-item href=/tags/ title>Tags</a><a class=menu-item href=/categories/ title>Categories</a><a class=menu-item href=/about/ title=About>About</a><a href=# onclick=return!1 class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw"></i>
</a><a href=# onclick=return!1 class=menu-item title="Select Language">English<i class="fas fa-chevron-right fa-fw"></i>
<select class=language-select title="Select Language" onchange="location=this.value"><option value=/posts/building-an-offline-first-react-web-app-using-watermelondb-in-phoenix-elixir/ selected>English</option></select></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class="toc-content always-active" id=toc-content-auto><nav id=TableOfContents><ul><li><a href=#installing-dependencies>Installing Dependencies</a></li><li><a href=#lets-code>Let&rsquo;s Code</a></li><li><a href=#setup-database>Setup <code>Database</code></a><ul><li><a href=#schema>Schema</a></li><li><a href=#model>Model</a></li></ul></li><li><a href=#appjs><code>App.js</code></a></li><li><a href=#postformjs><code>PostForm.js</code></a></li><li><a href=#postlistjs><code>PostList.js</code></a></li><li><a href=#postrowjs><code>PostRow.js</code></a></li><li><a href=#syncjs><code>sync.js</code></a></li><li><a href=#run-the-application>Run the Application</a></li><li><a href=#final-source-code>Final Source Code</a></li></ul></nav></div></div><script>document.getElementsByTagName("main")[0].setAttribute("pageStyle","normal")</script><script>document.getElementsByTagName("main")[0].setAttribute("autoTOC","true")</script><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Building an Offline-First React Web App Using WatermelonDB in Phoenix (Elixir)</h1><div class=post-meta><div class=post-meta-line><span class=post-author><i class="author fas fa-user-circle fa-fw"></i><a href=/ title=Author rel=author class=author>Fahri</a>
</span>&nbsp;<span class=post-category>included in </span>&nbsp;<span class=post-category>categories <a href=/categories/react/><i class="far fa-folder fa-fw"></i>React</a>&nbsp;<a href=/categories/phoenix/><i class="far fa-folder fa-fw"></i>Phoenix</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2020-04-29>2020-04-29</time>&nbsp;<i class="far fa-edit fa-fw"></i>&nbsp;<time datetime=2020-04-29>2020-04-29</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;1033 words&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;5 minutes&nbsp;</div></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#installing-dependencies>Installing Dependencies</a></li><li><a href=#lets-code>Let&rsquo;s Code</a></li><li><a href=#setup-database>Setup <code>Database</code></a><ul><li><a href=#schema>Schema</a></li><li><a href=#model>Model</a></li></ul></li><li><a href=#appjs><code>App.js</code></a></li><li><a href=#postformjs><code>PostForm.js</code></a></li><li><a href=#postlistjs><code>PostList.js</code></a></li><li><a href=#postrowjs><code>PostRow.js</code></a></li><li><a href=#syncjs><code>sync.js</code></a></li><li><a href=#run-the-application>Run the Application</a></li><li><a href=#final-source-code>Final Source Code</a></li></ul></nav></div></div><div class=content id=content><p>We will build a web application that supports local db synced with remote db. This post is a continuation from the previous post: <a href=https://fahri.id/posts/how-to-build-watermelondb-sync-backend-in-elixir/ rel>How to Build WatermelonDB Sync Backend in Elixir</a>.</p><h2 id=installing-dependencies class=headerLink><a href=#installing-dependencies class=header-mark></a>Installing Dependencies</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ <span class=nb>cd</span> assets
</span></span><span class=line><span class=cl>$ npm i react react-dom uuid @nozbe/watermelondb @nozbe/with-observables
</span></span><span class=line><span class=cl>$ npm i -D @babel/preset-react @babel/plugin-proposal-decorators @babel/plugin-proposal-class-properties @babel/plugin-transform-runtime
</span></span></code></pre></div><p>Configure <code>assets/.babelrc</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;presets&#34;</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;@babel/preset-env&#34;</span><span class=p>,</span> <span class=s2>&#34;@babel/preset-react&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;plugins&#34;</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=s2>&#34;@babel/plugin-proposal-decorators&#34;</span><span class=p>,</span> <span class=p>{</span> <span class=s2>&#34;legacy&#34;</span><span class=o>:</span> <span class=kc>true</span> <span class=p>}],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=s2>&#34;@babel/plugin-proposal-class-properties&#34;</span><span class=p>,</span> <span class=p>{</span> <span class=s2>&#34;loose&#34;</span><span class=o>:</span> <span class=kc>true</span> <span class=p>}],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span>
</span></span><span class=line><span class=cl>          <span class=s2>&#34;@babel/plugin-transform-runtime&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>           <span class=p>{</span>
</span></span><span class=line><span class=cl>             <span class=s2>&#34;helpers&#34;</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>             <span class=s2>&#34;regenerator&#34;</span><span class=o>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>           <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=lets-code class=headerLink><a href=#lets-code class=header-mark></a>Let&rsquo;s Code</h2><p>Remove entirely <code>lib/blog_app_web/templates/page/index.html.eex</code> and replace it with this code:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>div</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;blog-app&#34;</span> <span class=p>/&gt;</span>
</span></span></code></pre></div><p>All frontend code related to blog app will be located in <code>assets/js/blog</code>.
So, we will import entry point of blog app in <code>assets/js/app.js</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// assets/js/app.js
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=s2>&#34;../css/app.scss&#34;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=s2>&#34;phoenix_html&#34;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=s2>&#34;./blog&#34;</span>
</span></span></code></pre></div><h2 id=setup-database class=headerLink><a href=#setup-database class=header-mark></a>Setup <code>Database</code></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-react data-lang=react><span class=line><span class=cl><span class=c1>// assets/js/blog/index.js
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=nx>React</span> <span class=nx>from</span> <span class=s1>&#39;react&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>render</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;react-dom&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>Database</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;@nozbe/watermelondb&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>LokiJSAdapter</span> <span class=nx>from</span> <span class=s1>&#39;@nozbe/watermelondb/adapters/lokijs&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>DatabaseProvider</span> <span class=nx>from</span> <span class=s1>&#39;@nozbe/watermelondb/DatabaseProvider&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>schema</span> <span class=nx>from</span> <span class=s1>&#39;./model/schema&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>Post</span> <span class=nx>from</span> <span class=s1>&#39;./model/Post&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>App</span> <span class=nx>from</span> <span class=s1>&#39;./App&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>adapter</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>LokiJSAdapter</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>schema</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>useWebWorker</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>useIncrementalIndexedDB</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>onIndexedDBVersionChange</span><span class=o>:</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>checkIfUserIsLoggedIn</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nb>window</span><span class=p>.</span><span class=nx>location</span><span class=p>.</span><span class=nx>reload</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>database</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Database</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>adapter</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>modelClasses</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=nx>Post</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nx>actionsEnabled</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>rootElement</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s1>&#39;blog-app&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>render</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>DatabaseProvider</span> <span class=na>database</span><span class=o>=</span><span class=p>{</span><span class=nx>database</span><span class=p>}&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>App</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>DatabaseProvider</span><span class=p>&gt;,</span>
</span></span><span class=line><span class=cl>  <span class=nx>rootElement</span><span class=p>);</span>
</span></span></code></pre></div><h3 id=schema class=headerLink><a href=#schema class=header-mark></a>Schema</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-react data-lang=react><span class=line><span class=cl><span class=c1>// assets/js/blog/model/schema.js
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=p>{</span> <span class=nx>appSchema</span><span class=p>,</span> <span class=nx>tableSchema</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;@nozbe/watermelondb&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>mySchema</span> <span class=o>=</span> <span class=nx>appSchema</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>version</span><span class=o>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>tables</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=nx>tableSchema</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;posts&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>columns</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span> <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;title&#39;</span><span class=p>,</span> <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;string&#39;</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span> <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;content&#39;</span><span class=p>,</span> <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;string&#39;</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span> <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;likes&#39;</span><span class=p>,</span> <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;number&#39;</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span> <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;created_at&#39;</span><span class=p>,</span> <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;number&#39;</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span> <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;updated_at&#39;</span><span class=p>,</span> <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;number&#39;</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>mySchema</span>
</span></span></code></pre></div><h3 id=model class=headerLink><a href=#model class=header-mark></a>Model</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-react data-lang=react><span class=line><span class=cl><span class=c1>// assets/js/blog/model/Post.js
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=p>{</span> <span class=nx>Model</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;@nozbe/watermelondb&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>field</span><span class=p>,</span> <span class=nx>date</span><span class=p>,</span> <span class=nx>readonly</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;@nozbe/watermelondb/decorators&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=kr>class</span> <span class=nx>Post</span> <span class=kr>extends</span> <span class=nx>Model</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>static</span> <span class=nx>table</span> <span class=o>=</span> <span class=s1>&#39;posts&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=err>@</span><span class=nx>field</span><span class=p>(</span><span class=s1>&#39;title&#39;</span><span class=p>)</span> <span class=nx>title</span>
</span></span><span class=line><span class=cl>    <span class=err>@</span><span class=nx>field</span><span class=p>(</span><span class=s1>&#39;content&#39;</span><span class=p>)</span> <span class=nx>content</span>
</span></span><span class=line><span class=cl>    <span class=err>@</span><span class=nx>field</span><span class=p>(</span><span class=s1>&#39;likes&#39;</span><span class=p>)</span> <span class=nx>likes</span>
</span></span><span class=line><span class=cl>    <span class=err>@</span><span class=nx>readonly</span> <span class=err>@</span><span class=nx>date</span><span class=p>(</span><span class=s1>&#39;created_at&#39;</span><span class=p>)</span> <span class=nx>createdAt</span>
</span></span><span class=line><span class=cl>    <span class=err>@</span><span class=nx>readonly</span> <span class=err>@</span><span class=nx>date</span><span class=p>(</span><span class=s1>&#39;updated_at&#39;</span><span class=p>)</span> <span class=nx>updatedAt</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=appjs class=headerLink><a href=#appjs class=header-mark></a><code>App.js</code></h2><p><a class=lightgallery href="http://www.plantuml.com/plantuml/proxy?src=https://raw.githubusercontent.com/fahrinh/my-blog/master/diagram/blog-app-mockup.plantuml" title="BlogApp Mockup" data-thumbnail="http://www.plantuml.com/plantuml/proxy?src=https://raw.githubusercontent.com/fahrinh/my-blog/master/diagram/blog-app-mockup.plantuml"><img class=lazyload data-src="http://www.plantuml.com/plantuml/proxy?src=https://raw.githubusercontent.com/fahrinh/my-blog/master/diagram/blog-app-mockup.plantuml" data-srcset="http://www.plantuml.com/plantuml/proxy?src=https://raw.githubusercontent.com/fahrinh/my-blog/master/diagram/blog-app-mockup.plantuml, http://www.plantuml.com/plantuml/proxy?src=https://raw.githubusercontent.com/fahrinh/my-blog/master/diagram/blog-app-mockup.plantuml 1.5x, http://www.plantuml.com/plantuml/proxy?src=https://raw.githubusercontent.com/fahrinh/my-blog/master/diagram/blog-app-mockup.plantuml 2x" data-sizes=auto alt="http://www.plantuml.com/plantuml/proxy?src=https://raw.githubusercontent.com/fahrinh/my-blog/master/diagram/blog-app-mockup.plantuml"></a></p><p><code>&lt;App/></code> consists of:</p><ul><li><code>&lt;PostForm/></code></li><li><code>&lt;PostList/></code><ul><li><code>&lt;PostRow/></code> for each row data</li></ul></li></ul><p>As parent component, <code>App</code> handles all actions related to form (<code>Add New/Reset</code>, <code>Save</code>, <code>Sync</code>) and row data (<code>Edit</code>, <code>Delete</code>).</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-react data-lang=react><span class=line><span class=cl><span class=c1>// assets/js/blog/App.js
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=nx>React</span><span class=p>,</span> <span class=p>{</span> <span class=nx>useState</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;react&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>useDatabase</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;@nozbe/watermelondb/hooks&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>v4</span> <span class=nx>as</span> <span class=nx>uuidv4</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;uuid&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>syncData</span> <span class=nx>from</span> <span class=s1>&#39;./sync&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>PostList</span> <span class=nx>from</span> <span class=s1>&#39;./PostList&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>PostForm</span> <span class=nx>from</span> <span class=s1>&#39;./PostForm&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=kd>function</span> <span class=nx>App</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>database</span> <span class=o>=</span> <span class=nx>useDatabase</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=p>[</span><span class=nx>post</span><span class=p>,</span> <span class=nx>setPost</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>postsCollection</span> <span class=o>=</span> <span class=nx>database</span><span class=p>.</span><span class=nx>collections</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s2>&#34;posts&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>function</span> <span class=nx>clearPost</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>setPost</span><span class=p>(</span><span class=kc>undefined</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>function</span> <span class=nx>onEdit</span><span class=p>(</span><span class=nx>selectedPost</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>setPost</span><span class=p>(</span><span class=nx>selectedPost</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=kd>function</span> <span class=nx>onDelete</span><span class=p>(</span><span class=nx>selectedPost</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=nx>database</span><span class=p>.</span><span class=nx>action</span><span class=p>(</span><span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kr>await</span> <span class=nx>selectedPost</span><span class=p>.</span><span class=nx>markAsDeleted</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=kd>function</span> <span class=nx>createPost</span><span class=p>(</span><span class=nx>inputtedForm</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=nx>database</span><span class=p>.</span><span class=nx>action</span><span class=p>(</span><span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>newPost</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>postsCollection</span><span class=p>.</span><span class=nx>create</span><span class=p>(</span><span class=nx>post</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>post</span><span class=p>.</span><span class=nx>_raw</span><span class=p>.</span><span class=nx>id</span> <span class=o>=</span> <span class=nx>uuidv4</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=nx>post</span><span class=p>.</span><span class=nx>title</span> <span class=o>=</span> <span class=nx>inputtedForm</span><span class=p>.</span><span class=nx>title</span>
</span></span><span class=line><span class=cl>                <span class=nx>post</span><span class=p>.</span><span class=nx>content</span> <span class=o>=</span> <span class=nx>inputtedForm</span><span class=p>.</span><span class=nx>content</span>
</span></span><span class=line><span class=cl>                <span class=nx>post</span><span class=p>.</span><span class=nx>likes</span> <span class=o>=</span> <span class=nx>inputtedForm</span><span class=p>.</span><span class=nx>likes</span>
</span></span><span class=line><span class=cl>            <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=kd>function</span> <span class=nx>updatePost</span><span class=p>(</span><span class=nx>currentPost</span><span class=p>,</span> <span class=nx>inputtedForm</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=nx>database</span><span class=p>.</span><span class=nx>action</span><span class=p>(</span><span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kr>await</span> <span class=nx>currentPost</span><span class=p>.</span><span class=nx>update</span><span class=p>(</span><span class=nx>post</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>post</span><span class=p>.</span><span class=nx>title</span> <span class=o>=</span> <span class=nx>inputtedForm</span><span class=p>.</span><span class=nx>title</span>
</span></span><span class=line><span class=cl>                <span class=nx>post</span><span class=p>.</span><span class=nx>content</span> <span class=o>=</span> <span class=nx>inputtedForm</span><span class=p>.</span><span class=nx>content</span>
</span></span><span class=line><span class=cl>                <span class=nx>post</span><span class=p>.</span><span class=nx>likes</span> <span class=o>=</span> <span class=nx>inputtedForm</span><span class=p>.</span><span class=nx>likes</span>
</span></span><span class=line><span class=cl>            <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>PostForm</span> <span class=na>post</span><span class=o>=</span><span class=p>{</span><span class=nx>post</span><span class=p>}</span> <span class=na>clearPost</span><span class=o>=</span><span class=p>{</span><span class=nx>clearPost</span><span class=p>}</span> <span class=na>createPost</span><span class=o>=</span><span class=p>{</span><span class=nx>createPost</span><span class=p>}</span> <span class=na>updatePost</span><span class=o>=</span><span class=p>{</span><span class=nx>updatePost</span><span class=p>}</span> <span class=na>syncData</span><span class=o>=</span><span class=p>{()</span> <span class=p>=&gt;</span> <span class=nx>syncData</span><span class=p>(</span><span class=nx>database</span><span class=p>)}</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>PostList</span> <span class=na>onEdit</span><span class=o>=</span><span class=p>{</span><span class=nx>onEdit</span><span class=p>}</span> <span class=na>onDelete</span><span class=o>=</span><span class=p>{</span><span class=nx>onDelete</span><span class=p>}</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=postformjs class=headerLink><a href=#postformjs class=header-mark></a><code>PostForm.js</code></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-react data-lang=react><span class=line><span class=cl><span class=c1>// assets/js/blog/PostForm.js
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=nx>React</span><span class=p>,</span> <span class=p>{</span> <span class=nx>useState</span><span class=p>,</span> <span class=nx>useEffect</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;react&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=kd>function</span> <span class=nx>PostForm</span><span class=p>({</span> <span class=nx>post</span><span class=p>,</span> <span class=nx>clearPost</span><span class=p>,</span> <span class=nx>createPost</span><span class=p>,</span> <span class=nx>updatePost</span><span class=p>,</span> <span class=nx>syncData</span> <span class=p>})</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=p>[</span><span class=nx>title</span><span class=p>,</span> <span class=nx>setTitle</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>(</span><span class=nx>post</span> <span class=o>?</span> <span class=nx>post</span><span class=p>.</span><span class=nx>title</span> <span class=o>:</span> <span class=s2>&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=p>[</span><span class=nx>content</span><span class=p>,</span> <span class=nx>setContent</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>(</span><span class=nx>post</span> <span class=o>?</span> <span class=nx>post</span><span class=p>.</span><span class=nx>content</span> <span class=o>:</span> <span class=s2>&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=p>[</span><span class=nx>likes</span><span class=p>,</span> <span class=nx>setLikes</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>(</span><span class=nx>post</span> <span class=o>?</span> <span class=nx>post</span><span class=p>.</span><span class=nx>likes</span> <span class=o>:</span> <span class=s2>&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>useEffect</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>setTitle</span><span class=p>(</span><span class=nx>post</span> <span class=o>?</span> <span class=nx>post</span><span class=p>.</span><span class=nx>title</span> <span class=o>:</span> <span class=s2>&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nx>setContent</span><span class=p>(</span><span class=nx>post</span> <span class=o>?</span> <span class=nx>post</span><span class=p>.</span><span class=nx>content</span> <span class=o>:</span> <span class=s2>&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nx>setLikes</span><span class=p>(</span><span class=nx>post</span> <span class=o>?</span> <span class=nx>post</span><span class=p>.</span><span class=nx>likes</span> <span class=o>:</span> <span class=s2>&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span> <span class=p>[</span><span class=nx>post</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>onReset</span> <span class=o>=</span> <span class=p>(</span><span class=nx>e</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>e</span><span class=p>.</span><span class=nx>preventDefault</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=nx>clearForm</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>onSync</span> <span class=o>=</span> <span class=p>(</span><span class=nx>e</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>e</span><span class=p>.</span><span class=nx>preventDefault</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=nx>syncData</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>onSubmit</span> <span class=o>=</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>e</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>e</span><span class=p>.</span><span class=nx>preventDefault</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>inputtedForm</span> <span class=o>=</span> <span class=p>{</span> <span class=nx>title</span><span class=p>,</span> <span class=nx>content</span><span class=p>,</span> <span class=nx>likes</span><span class=o>:</span> <span class=nb>parseInt</span><span class=p>(</span><span class=nx>likes</span><span class=p>)</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>post</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kr>await</span> <span class=nx>updatePost</span><span class=p>(</span><span class=nx>post</span><span class=p>,</span> <span class=nx>inputtedForm</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kr>await</span> <span class=nx>createPost</span><span class=p>(</span><span class=nx>inputtedForm</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nx>clearForm</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>clearForm</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>setTitle</span><span class=p>(</span><span class=s2>&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nx>setContent</span><span class=p>(</span><span class=s2>&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nx>setLikes</span><span class=p>(</span><span class=s2>&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nx>clearPost</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>form</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nx>Title</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;text&#34;</span> <span class=na>value</span><span class=o>=</span><span class=p>{</span><span class=nx>title</span><span class=p>}</span> <span class=na>onChange</span><span class=o>=</span><span class=p>{(</span><span class=nx>e</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>setTitle</span><span class=p>(</span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>)}</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;/</span><span class=nt>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nx>Content</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;text&#34;</span> <span class=na>value</span><span class=o>=</span><span class=p>{</span><span class=nx>content</span><span class=p>}</span> <span class=na>onChange</span><span class=o>=</span><span class=p>{(</span><span class=nx>e</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>setContent</span><span class=p>(</span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>)}</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;/</span><span class=nt>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nx>Likes</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;number&#34;</span> <span class=na>value</span><span class=o>=</span><span class=p>{</span><span class=nx>likes</span><span class=p>}</span> <span class=na>onChange</span><span class=o>=</span><span class=p>{(</span><span class=nx>e</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>setLikes</span><span class=p>(</span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>)}</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;/</span><span class=nt>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>button</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;button button-outline&#34;</span> <span class=na>onClick</span><span class=o>=</span><span class=p>{</span><span class=nx>onReset</span><span class=p>}&gt;</span><span class=nx>Add</span> <span class=nx>New</span> <span class=o>/</span> <span class=nx>Reset</span><span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>button</span> <span class=na>onClick</span><span class=o>=</span><span class=p>{</span><span class=nx>onSubmit</span><span class=p>}&gt;</span><span class=nx>Save</span><span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>button</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;button button-clear&#34;</span> <span class=na>onClick</span><span class=o>=</span><span class=p>{</span><span class=nx>onSync</span><span class=p>}&gt;</span><span class=nx>Sync</span><span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>form</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=postlistjs class=headerLink><a href=#postlistjs class=header-mark></a><code>PostList.js</code></h2><p><code>PostList</code> is enhanced component wrapped with <code>withObservables</code> to become reactive whenever data in <code>posts</code> get added or deleted.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-react data-lang=react><span class=line><span class=cl><span class=c1>// assets/js/blog/PostList.js
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=nx>React</span> <span class=nx>from</span> <span class=s1>&#39;react&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>withObservables</span> <span class=nx>from</span> <span class=s2>&#34;@nozbe/with-observables&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>withDatabase</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;@nozbe/watermelondb/DatabaseProvider&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>PostRow</span> <span class=nx>from</span> <span class=s1>&#39;./PostRow&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>PostList</span> <span class=o>=</span> <span class=p>({</span> <span class=nx>posts</span><span class=p>,</span> <span class=nx>onEdit</span><span class=p>,</span> <span class=nx>onDelete</span> <span class=p>})</span> <span class=p>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>table</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>thead</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>tr</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=nt>th</span><span class=p>&gt;</span><span class=nx>Title</span><span class=p>&lt;/</span><span class=nt>th</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=nt>th</span><span class=p>&gt;</span><span class=nx>Content</span><span class=p>&lt;/</span><span class=nt>th</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=nt>th</span><span class=p>&gt;</span><span class=nx>Likes</span><span class=p>&lt;/</span><span class=nt>th</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=nt>th</span><span class=p>&gt;</span><span class=nx>Created</span> <span class=nx>At</span><span class=p>&lt;/</span><span class=nt>th</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=nt>th</span><span class=p>&gt;</span><span class=nx>Updated</span> <span class=nx>At</span><span class=p>&lt;/</span><span class=nt>th</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=nt>th</span><span class=p>&gt;</span><span class=nx>Actions</span><span class=p>&lt;/</span><span class=nt>th</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;/</span><span class=nt>tr</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>thead</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>tbody</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span><span class=nx>posts</span><span class=p>.</span><span class=nx>map</span><span class=p>(</span><span class=nx>post</span> <span class=p>=&gt;</span> <span class=p>&lt;</span><span class=nt>PostRow</span> <span class=na>key</span><span class=o>=</span><span class=p>{</span><span class=nx>post</span><span class=p>.</span><span class=nx>_raw</span><span class=p>.</span><span class=nx>id</span><span class=p>}</span> <span class=na>post</span><span class=o>=</span><span class=p>{</span><span class=nx>post</span><span class=p>}</span> <span class=na>onEdit</span><span class=o>=</span><span class=p>{</span><span class=nx>onEdit</span><span class=p>}</span> <span class=na>onDelete</span><span class=o>=</span><span class=p>{</span><span class=nx>onDelete</span><span class=p>}</span> <span class=p>/&gt;)}</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>tbody</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>table</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>withDatabase</span><span class=p>(</span><span class=nx>withObservables</span><span class=p>([],</span> <span class=p>({</span> <span class=nx>database</span> <span class=p>})</span> <span class=p>=&gt;</span> <span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>posts</span><span class=o>:</span> <span class=nx>database</span><span class=p>.</span><span class=nx>collections</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;posts&#39;</span><span class=p>).</span><span class=nx>query</span><span class=p>().</span><span class=nx>observe</span><span class=p>(),</span>
</span></span><span class=line><span class=cl><span class=p>}))(</span><span class=nx>PostList</span><span class=p>))</span>
</span></span></code></pre></div><h2 id=postrowjs class=headerLink><a href=#postrowjs class=header-mark></a><code>PostRow.js</code></h2><p><code>PostRow</code> is also reactive component. It will automatically rerender the component whenever data changes (i.e. <code>post</code> get updated).</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-react data-lang=react><span class=line><span class=cl><span class=c1>// assets/js/blog/PostRow.js
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=nx>React</span> <span class=nx>from</span> <span class=s1>&#39;react&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>withObservables</span> <span class=nx>from</span> <span class=s2>&#34;@nozbe/with-observables&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>PostRow</span> <span class=o>=</span> <span class=p>({</span> <span class=nx>post</span><span class=p>,</span> <span class=nx>onEdit</span><span class=p>,</span> <span class=nx>onDelete</span> <span class=p>})</span> <span class=p>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>tr</span> <span class=na>key</span><span class=o>=</span><span class=p>{</span><span class=nx>post</span><span class=p>.</span><span class=nx>_raw</span><span class=p>.</span><span class=nx>id</span><span class=p>}&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>td</span><span class=p>&gt;{</span><span class=nx>post</span><span class=p>.</span><span class=nx>title</span><span class=p>}&lt;/</span><span class=nt>td</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>td</span><span class=p>&gt;{</span><span class=nx>post</span><span class=p>.</span><span class=nx>content</span><span class=p>}&lt;/</span><span class=nt>td</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>td</span><span class=p>&gt;{</span><span class=nx>post</span><span class=p>.</span><span class=nx>likes</span><span class=p>}&lt;/</span><span class=nt>td</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>td</span><span class=p>&gt;{</span><span class=nx>post</span><span class=p>.</span><span class=nx>createdAt</span><span class=p>.</span><span class=nx>toString</span><span class=p>()}&lt;/</span><span class=nt>td</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>td</span><span class=p>&gt;{</span><span class=nx>post</span><span class=p>.</span><span class=nx>updatedAt</span><span class=p>.</span><span class=nx>toString</span><span class=p>()}&lt;/</span><span class=nt>td</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>td</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>button</span> <span class=na>onClick</span><span class=o>=</span><span class=p>{(</span><span class=nx>e</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span><span class=nx>onEdit</span><span class=p>(</span><span class=nx>post</span><span class=p>)}}&gt;</span><span class=nx>Edit</span><span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>button</span> <span class=na>onClick</span><span class=o>=</span><span class=p>{(</span><span class=nx>e</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span><span class=nx>onDelete</span><span class=p>(</span><span class=nx>post</span><span class=p>)}}&gt;</span><span class=nx>Delete</span><span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>td</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>tr</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>withObservables</span><span class=p>([</span><span class=s2>&#34;post&#34;</span><span class=p>],</span> <span class=p>({</span> <span class=nx>post</span> <span class=p>})</span> <span class=p>=&gt;</span> <span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>post</span><span class=o>:</span> <span class=nx>post</span><span class=p>.</span><span class=nx>observe</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}))(</span><span class=nx>PostRow</span><span class=p>)</span>
</span></span></code></pre></div><h2 id=syncjs class=headerLink><a href=#syncjs class=header-mark></a><code>sync.js</code></h2><p>Along with the backend, this is the core of sync capability in our app.
On <a href=https://fahri.id/posts/how-to-build-watermelondb-sync-backend-in-elixir/#workaround-for-sync-on-client-side rel>the previous post</a>, I have explained in detail why it needs a workaround.
Please read that first.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// assets/js/blog/sync.js
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=p>{</span> <span class=nx>synchronize</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;@nozbe/watermelondb/sync&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=kr>async</span> <span class=kd>function</span> <span class=nx>syncData</span><span class=p>(</span><span class=nx>database</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>latestVersionOfSession</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>changesOfSession</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>await</span> <span class=nx>synchronize</span><span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=nx>database</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>pullChanges</span><span class=o>:</span> <span class=kr>async</span> <span class=p>({</span> <span class=nx>lastPulledAt</span> <span class=p>})</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>response</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>fetch</span><span class=p>(</span><span class=sb>`http://localhost:4000/api/sync/pull?lastPulledVersion=</span><span class=si>${</span><span class=nx>lastPulledAt</span> <span class=o>||</span> <span class=mi>0</span><span class=si>}</span><span class=sb>`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>response</span><span class=p>.</span><span class=nx>ok</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=kr>await</span> <span class=nx>response</span><span class=p>.</span><span class=nx>text</span><span class=p>())</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=p>{</span> <span class=nx>changes</span><span class=p>,</span> <span class=nx>latestVersion</span> <span class=p>}</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>response</span><span class=p>.</span><span class=nx>json</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=nx>latestVersionOfSession</span> <span class=o>=</span> <span class=nx>latestVersion</span>
</span></span><span class=line><span class=cl>            <span class=nx>changesOfSession</span> <span class=o>=</span> <span class=nx>changes</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>{</span> <span class=nx>changes</span><span class=p>,</span> <span class=nx>timestamp</span><span class=o>:</span> <span class=nx>latestVersion</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=nx>pushChanges</span><span class=o>:</span> <span class=kr>async</span> <span class=p>({</span> <span class=nx>changes</span><span class=p>,</span> <span class=nx>lastPulledAt</span> <span class=p>})</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>response</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>fetch</span><span class=p>(</span><span class=sb>`http://localhost:4000/api/sync/push?lastPulledVersion=</span><span class=si>${</span><span class=nx>lastPulledAt</span> <span class=o>||</span> <span class=mi>0</span><span class=si>}</span><span class=sb>`</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>method</span><span class=o>:</span> <span class=s1>&#39;POST&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>headers</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;Content-Type&#39;</span><span class=o>:</span> <span class=s1>&#39;application/json&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=nx>body</span><span class=o>:</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>changes</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>})</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>response</span><span class=p>.</span><span class=nx>ok</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=kr>await</span> <span class=nx>response</span><span class=p>.</span><span class=nx>text</span><span class=p>())</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=p>{</span> <span class=nx>changes</span><span class=o>:</span> <span class=nx>changesFromPush</span><span class=p>,</span> <span class=nx>latestVersion</span> <span class=p>}</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>response</span><span class=p>.</span><span class=nx>json</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=nx>latestVersionOfSession</span> <span class=o>=</span> <span class=nx>latestVersion</span>
</span></span><span class=line><span class=cl>            <span class=nx>changesOfSession</span> <span class=o>=</span> <span class=nx>changesFromPush</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>await</span> <span class=nx>synchronize</span><span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=nx>database</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>pullChanges</span><span class=o>:</span> <span class=kr>async</span> <span class=p>({</span> <span class=nx>lastPulledAt</span> <span class=p>})</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>{</span> <span class=nx>changes</span><span class=o>:</span> <span class=nx>changesOfSession</span><span class=p>,</span> <span class=nx>timestamp</span><span class=o>:</span> <span class=nx>latestVersionOfSession</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=nx>pushChanges</span><span class=o>:</span> <span class=kr>async</span> <span class=p>({</span> <span class=nx>changes</span><span class=p>,</span> <span class=nx>lastPulledAt</span> <span class=p>})</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=kr>await</span> <span class=nx>response</span><span class=p>.</span><span class=nx>text</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=run-the-application class=headerLink><a href=#run-the-application class=header-mark></a>Run the Application</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ <span class=nb>cd</span> ../ <span class=c1># cd to project directory (blog_app)</span>
</span></span><span class=line><span class=cl>$ mix phx.server
</span></span></code></pre></div><p>Open <a href=http://localhost:4000 target=_blank rel="noopener noreferrer">http://localhost:4000</a></p><h2 id=final-source-code class=headerLink><a href=#final-source-code class=header-mark></a>Final Source Code</h2><p>All code (sync backend and frontend app) is available on <a href=https://github.com/fahrinh/blog-labs/tree/master/2020-04-24/blog_app target=_blank rel="noopener noreferrer">https://github.com/fahrinh/blog-labs/tree/master/2020-04-24/blog_app</a></p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2020-04-29</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/watermelondb/>WatermelonDB</a>,&nbsp;<a href=/tags/offline-first-app/>Offline First App</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/how-to-build-watermelondb-sync-backend-in-elixir/ class=prev rel=prev title="How to Build WatermelonDB Sync Backend in Elixir"><i class="fas fa-angle-left fa-fw"></i>How to Build WatermelonDB Sync Backend in Elixir</a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreferrer" title="Hugo 0.109.0">Hugo</a>&nbsp;|&nbsp;Theme - <a href=https://github.com/HEIGE-PCloud/DoIt target=_blank rel="noopener noreferrer" title="DoIt 0.2.13"><i class="far fa-edit fa-fw"></i> DoIt</a></div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2022</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank rel="noopener noreferrer">Fahri</a></span></div><div class=footer-line></div><div class=footer-line></div></div></footer></div><div id=fixed-buttons><a href=#back-to-top id=back-to-top-button class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw"></i></a></div><div class=assets><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/topbar/topbar.min.js></script><script type=text/javascript src=/lib/pjax/pjax.min.js></script><script type=text/javascript src=/js/theme.min.js defer></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-92345605-1")</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=UA-92345605-1" async></script></div><div class=pjax-assets><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:1e4},comment:{}}</script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script></div></body></html>